<!DOCTYPE HTML>
<html lang="zh-hans">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width;initial-scale=1">
	<link rel="stylesheet" href="/asset/css/style.css">
</head>


<body>
<h3>MySQL 性能分析--监控系统IO状态</h3>
<h4>用到的工具</h4>
<ul>
<li>
<p>监控IO用到的工具</p>
<p>我这里主要用到了iostat, 还有lsof来补助分析.</p>
</li>
<li>
<p>MySQL 涉及到磁盘IO的状态变量</p>
</li>
<li>
<p>测试脚本</p>
<p>我这里主要用到了python脚本对数据库重复写数据和读数据操作来观察IO状态变化</p>
</li>
</ul>
<h4>在监控IO状态之前，要先准备下测试环境</h4>
<h5>第一步，把MySQL datadir和各种Log配置到一个单独的分区去 (即使没有单独的分区，也不要放在系统目录中去，因为我们主要监控的是MySQL的IO状态)</h5>
<h5>第二步，建立一个数据库 和 测试表 (数据库就叫test_io， 表叫node, 是drupal 系统的node表，我简化了下)</h5>
<pre><code>create database test_io default charset utf8 collate utf8_general_ci;
  CREATE TABLE `node` (
        `nid` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'The primary identifier for a node.',
        `type` varchar(32) NOT NULL DEFAULT '' COMMENT 'The node_type.type of this node.',
        `title` varchar(255) NOT NULL DEFAULT '' COMMENT 'The title of this node, always treated as non-markup plain text.',
        `uid` int(11) NOT NULL DEFAULT '0' COMMENT 'The users.uid that owns this node; initially, this is the user that created it.',
        `status` int(11) NOT NULL DEFAULT '1' COMMENT 'Boolean indicating whether the node is published (visible to non-administrators).',
        `created` int(11) NOT NULL DEFAULT '0' COMMENT 'The Unix timestamp when the node was created.',
        `changed` int(11) NOT NULL DEFAULT '0' COMMENT 'The Unix timestamp when the node was most recently saved.',
        PRIMARY KEY (`nid`),
        KEY `node_changed` (`changed`),
        KEY `node_created` (`created`),
        KEY `node_status_type` (`status`,`type`,`nid`),
        KEY `node_title_type` (`title`,`type`(4)),
        KEY `node_type` (`type`(4)),
        KEY `uid` (`uid`)
    ) ENGINE=InnoDB AUTO_INCREMENT=30674 DEFAULT CHARSET=utf8;
</code></pre>
<h5>第三步， 创建一个python小脚本, 主要模拟了50个并发。 查询参数和类型在控制台指定.</h5>
<p><a href="http://example.com/" title="python 脚本测试并发">脚本源代码</a></p>
<pre><code>   io_test.py -c=100 -q=1 -t=1000 
   -c: 并发数
   -q: 查询类型： 1是插入语句，2是查询语句
   -t: 每个并发查询总数。 比如1000， 那么总查询数是: -c * 1000
</code></pre>
<h4>开始MySQL测试</h4>
<pre><code>    用适当的参数启动io_test.py脚本， 我要先看下插入数据的IO状态. 
    ``io_test.py -c=100 -q=1 -t=10000``
</code></pre>


</body>
</html>
